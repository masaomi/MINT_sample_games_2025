<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA Assembly Tetris üß¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 1000px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .info-box {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #1e3c72;
        }

        .info-box h3 {
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .game-layout {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .game-board-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .side-panel {
            width: 220px;
        }

        .stats {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            margin-bottom: 12px;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #1e3c72;
        }

        .game-status {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .status-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .status-indicator {
            font-size: 1.2em;
            font-weight: bold;
            padding: 8px;
            border-radius: 5px;
        }

        .status-indicator.playing {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .status-indicator.paused {
            background: #fff9c4;
            color: #f57f17;
        }

        .status-indicator.gameover {
            background: #ffcdd2;
            color: #c62828;
        }

        .next-read-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .next-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
        }

        .game-board {
            background: #fafafa;
            border: 3px solid #1e3c72;
            border-radius: 10px;
            padding: 15px;
            position: relative;
            height: 550px;
            overflow: hidden;
        }

        .target-sequence {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px dashed #1e3c72;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            text-align: center;
        }

        .target-label {
            font-size: 0.85em;
            color: #1e3c72;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .sequence {
            display: flex;
            justify-content: center;
            gap: 2px;
            flex-wrap: wrap;
        }

        .base {
            width: 26px;
            height: 26px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1em;
            border-radius: 4px;
            border: 2px solid rgba(0,0,0,0.1);
        }

        .base-A {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
        }

        .base-T {
            background: linear-gradient(135deg, #4ECDC4, #70E0D8);
            color: white;
        }

        .base-G {
            background: linear-gradient(135deg, #FFD93D, #FFE66D);
            color: #333;
        }

        .base-C {
            background: linear-gradient(135deg, #6BCB77, #8BDB89);
            color: white;
        }

        .assembly-area {
            height: 420px;
            position: relative;
            border-top: 2px solid #ddd;
            padding-top: 10px;
            overflow: hidden;
        }

        .read-block {
            position: absolute;
            display: flex;
            gap: 2px;
            padding: 6px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: left 0.1s ease;
            z-index: 10;
        }

        .read-block.falling {
            box-shadow: 0 6px 20px rgba(30, 60, 114, 0.5);
            border: 2px solid #1e3c72;
        }

        .read-block.placed {
            opacity: 0.85;
            border: 2px solid #999;
            z-index: 5;
        }

        .read-block.correct {
            animation: pulse 0.5s ease;
            border: 3px solid #4caf50 !important;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .read-block.incorrect {
            animation: shake 0.5s ease;
            border: 3px solid #f44336 !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .controls {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
        }

        .controls h4 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .controls p {
            font-size: 0.85em;
            color: #666;
            line-height: 1.5;
            margin: 3px 0;
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .mobile-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .mobile-controls-label {
            font-size: 0.9em;
            color: #666;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mobile-controls-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            font-size: 2em;
            border: 3px solid #1e3c72;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
            color: #1e3c72;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .control-btn:active:not(:disabled) {
            transform: scale(0.95);
            background: #e3f2fd;
        }

        .control-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        button {
            padding: 12px 20px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
            flex: 1;
            min-width: 140px;
        }

        .btn-new-game {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        .btn-pause {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .btn-hint {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            text-align: center;
            font-size: 1em;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .completion-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .completion-modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            animation: modalAppear 0.5s ease;
        }

        @keyframes modalAppear {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-content h2 {
            color: #1e3c72;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .modal-content .trophy {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .modal-stats {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .modal-stats p {
            font-size: 1.2em;
            margin: 10px 0;
            color: #555;
        }

        @media (max-width: 768px) {
            .game-layout {
                flex-direction: column;
            }

            .side-panel {
                width: 100%;
            }

            h1 {
                font-size: 1.8em;
            }

            .base {
                width: 22px;
                height: 22px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üß¨ DNA Assembly Tetris üß¨</h1>
        <p class="subtitle">Place falling Short Reads in the correct position!</p>

        <div class="info-box">
            <h3>üî¨ How to Play</h3>
            <p>
                Place the falling DNA Short Reads in the correct position to complete the target sequence!
                Use ‚¨ÖÔ∏è‚û°Ô∏è keys to move left/right, and ‚¨áÔ∏è key for fast drop. Score points by placing them correctly!
            </p>
        </div>

        <div class="game-layout">
            <div class="game-board-container">
                <div class="message info" id="message">
                    Use ‚Üê‚Üí to move, ‚Üì for fast drop!
                </div>

                <div class="game-board">
                    <div class="target-sequence">
                        <div class="target-label">üéØ Target Sequence (Complete this sequence!)</div>
                        <div class="sequence" id="targetSequence"></div>
                    </div>

                    <div class="assembly-area" id="assemblyArea">
                        <!-- Reads will fall here -->
                    </div>
                </div>

                <div class="buttons">
                    <button class="btn-new-game" onclick="startNewGame()">üéÆ New Game</button>
                    <button class="btn-pause" id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è Pause</button>
                    <button class="btn-hint" onclick="showHint()">üí° Hint</button>
                </div>

                <div class="mobile-controls">
                    <div class="mobile-controls-label">üì± Touch Controls</div>
                    <div class="mobile-controls-row">
                        <button class="control-btn" id="leftBtn" ontouchstart="handleTouchControl('left')" onclick="handleControl('left')">‚¨ÖÔ∏è</button>
                        <button class="control-btn" id="downBtn" ontouchstart="handleTouchControl('down')" onclick="handleControl('down')">‚¨áÔ∏è</button>
                        <button class="control-btn" id="rightBtn" ontouchstart="handleTouchControl('right')" onclick="handleControl('right')">‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <div class="side-panel">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Score</div>
                        <div class="stat-value" id="score">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Placed</div>
                        <div class="stat-value" id="placed">0/6</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Accuracy</div>
                        <div class="stat-value" id="accuracy">100%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Level</div>
                        <div class="stat-value" id="level">1</div>
                    </div>
                </div>

                <div class="game-status">
                    <div class="status-label">Game Status</div>
                    <div class="status-indicator playing" id="statusIndicator">Playing</div>
                </div>

                <div class="next-read-container">
                    <div class="next-label">üìã Next Read</div>
                    <div class="sequence" id="nextRead"></div>
                </div>

                <div class="controls">
                    <h4>üéÆ Controls</h4>
                    <p>‚¨ÖÔ∏è Move left</p>
                    <p>‚û°Ô∏è Move right</p>
                    <p>‚¨áÔ∏è Fast drop</p>
                    <p>‚è∏Ô∏è Pause</p>
                </div>
            </div>
        </div>
    </div>

    <div class="completion-modal" id="completionModal">
        <div class="modal-content">
            <div class="trophy">üèÜ</div>
            <h2 id="modalTitle">Assembly Complete!</h2>
            <p id="modalMessage">You placed all Short Reads!</p>
            <div class="modal-stats">
                <p>üåü Final Score: <strong id="finalScore">0</strong></p>
                <p>üéØ Accuracy: <strong id="finalAccuracy">100%</strong></p>
                <p>üìä Level Reached: <strong id="finalLevel">1</strong></p>
                <p>‚≠ê Rating: <strong id="rating">Perfect!</strong></p>
            </div>
            <button class="btn-new-game" onclick="closeModalAndStartNew()">Play Again</button>
        </div>
    </div>

    <script>
        // Game state
        let score = 0;
        let level = 1;
        let placedReads = 0;
        let totalReads = 6;
        let correctPlacements = 0;
        let totalPlacements = 0;
        let targetSequence = [];
        let reads = [];
        let currentReadIndex = 0;
        let fallingRead = null;
        let placedReadElements = [];
        let gameRunning = false;
        let gamePaused = false;
        let gameCompleted = false;
        let fallSpeed = 800; // ms per step
        let fallInterval = null;

        // Generate random DNA sequence
        function generateSequence(length) {
            const bases = ['A', 'T', 'G', 'C'];
            const sequence = [];
            for (let i = 0; i < length; i++) {
                sequence.push(bases[Math.floor(Math.random() * bases.length)]);
            }
            return sequence;
        }

        // Generate reads from target sequence
        function generateReads(sequence, readLength, numReads) {
            const reads = [];
            const step = Math.floor((sequence.length - readLength) / (numReads - 1));
            
            for (let i = 0; i < numReads; i++) {
                const start = Math.min(i * step, sequence.length - readLength);
                const read = {
                    sequence: sequence.slice(start, start + readLength),
                    correctPosition: start,
                    placed: false
                };
                reads.push(read);
            }
            
            // Shuffle reads
            return shuffle(reads);
        }

        // Shuffle array
        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Render sequence
        function renderSequence(sequence, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            sequence.forEach(base => {
                const baseDiv = document.createElement('div');
                baseDiv.className = `base base-${base}`;
                baseDiv.textContent = base;
                container.appendChild(baseDiv);
            });
        }

        // Initialize game
        function startNewGame() {
            // Reset state
            score = 0;
            level = 1;
            placedReads = 0;
            totalReads = 6;
            correctPlacements = 0;
            totalPlacements = 0;
            currentReadIndex = 0;
            fallingRead = null;
            placedReadElements = [];
            gameRunning = true;
            gamePaused = false;
            gameCompleted = false;
            fallSpeed = 800;

            // Clear intervals
            if (fallInterval) {
                clearInterval(fallInterval);
                fallInterval = null;
            }

            // Generate target sequence (22 bases)
            targetSequence = generateSequence(22);
            
            // Generate 6 reads of length 7 with overlaps
            reads = generateReads(targetSequence, 7, totalReads);

            renderSequence(targetSequence, 'targetSequence');
            
            // Clear assembly area
            document.getElementById('assemblyArea').innerHTML = '';
            
            // Show first read in next read preview
            if (reads.length > 0) {
                renderSequence(reads[0].sequence, 'nextRead');
            }

            updateDisplay();
            updateStatus('playing');
            updateControlButtons();
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('pauseBtn').innerHTML = '‚è∏Ô∏è Pause';
            showMessage('Use ‚Üê‚Üí to move, ‚Üì for fast drop!', 'info');

            // Start spawning reads
            setTimeout(() => {
                spawnNextRead();
            }, 1000);
        }

        // Spawn next read
        function spawnNextRead() {
            if (!gameRunning || gamePaused || gameCompleted) return;
            if (currentReadIndex >= reads.length) return;
            if (fallingRead) return;

            const read = reads[currentReadIndex];
            const readElement = createReadElement(read, currentReadIndex);
            
            document.getElementById('assemblyArea').appendChild(readElement);
            
            fallingRead = {
                element: readElement,
                read: read,
                index: currentReadIndex,
                x: Math.floor(targetSequence.length / 2) - Math.floor(read.sequence.length / 2),
                y: 0,
                speed: fallSpeed
            };

            updateReadPosition();

            currentReadIndex++;
            
            // Show next read preview
            if (currentReadIndex < reads.length) {
                renderSequence(reads[currentReadIndex].sequence, 'nextRead');
            } else {
                document.getElementById('nextRead').innerHTML = '<p style="text-align: center; color: #999; font-size: 0.9em;">Last Read</p>';
            }

            // Update control buttons
            updateControlButtons();

            // Start falling
            startFalling();
        }

        // Create read element
        function createReadElement(read, index) {
            const readDiv = document.createElement('div');
            readDiv.className = 'read-block falling';
            readDiv.dataset.index = index;

            read.sequence.forEach(base => {
                const baseDiv = document.createElement('div');
                baseDiv.className = `base base-${base}`;
                baseDiv.textContent = base;
                readDiv.appendChild(baseDiv);
            });

            return readDiv;
        }

        // Update read position
        function updateReadPosition() {
            if (!fallingRead) return;
            
            const baseWidth = 28;
            fallingRead.element.style.left = (fallingRead.x * baseWidth) + 'px';
            fallingRead.element.style.top = (fallingRead.y) + 'px';
        }

        // Start falling
        function startFalling() {
            if (fallInterval) clearInterval(fallInterval);
            
            fallInterval = setInterval(() => {
                if (!gameRunning || gamePaused || !fallingRead) {
                    clearInterval(fallInterval);
                    return;
                }

                fallingRead.y += 40;
                updateReadPosition();

                // Check if reached bottom
                if (fallingRead.y >= 370) {
                    landRead();
                }
            }, fallingRead.speed);
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!fallingRead || !gameRunning || gamePaused) return;

            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    if (fallingRead.x > 0) {
                        fallingRead.x--;
                        updateReadPosition();
                    }
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    const maxX = targetSequence.length - fallingRead.read.sequence.length;
                    if (fallingRead.x < maxX) {
                        fallingRead.x++;
                        updateReadPosition();
                    }
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    // Fast drop
                    if (fallInterval) clearInterval(fallInterval);
                    fallingRead.speed = 50;
                    startFalling();
                    break;
            }
        });

        // Handle touch control (prevent default and handle immediately)
        function handleTouchControl(direction) {
            event.preventDefault();
            handleControl(direction);
        }

        // Handle control button clicks
        function handleControl(direction) {
            if (!fallingRead || !gameRunning || gamePaused) return;

            switch(direction) {
                case 'left':
                    if (fallingRead.x > 0) {
                        fallingRead.x--;
                        updateReadPosition();
                    }
                    break;
                case 'right':
                    const maxX = targetSequence.length - fallingRead.read.sequence.length;
                    if (fallingRead.x < maxX) {
                        fallingRead.x++;
                        updateReadPosition();
                    }
                    break;
                case 'down':
                    // Fast drop
                    if (fallInterval) clearInterval(fallInterval);
                    fallingRead.speed = 50;
                    startFalling();
                    break;
            }
        }

        // Update control buttons state
        function updateControlButtons() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const downBtn = document.getElementById('downBtn');
            
            const enabled = fallingRead && gameRunning && !gamePaused;
            
            leftBtn.disabled = !enabled;
            rightBtn.disabled = !enabled;
            downBtn.disabled = !enabled;
        }

        // Land read
        function landRead() {
            if (!fallingRead) return;

            clearInterval(fallInterval);

            const element = fallingRead.element;
            const read = fallingRead.read;
            const placedX = fallingRead.x;

            // Check if position is correct
            const isCorrect = (placedX === read.correctPosition);

            totalPlacements++;
            
            if (isCorrect) {
                correctPlacements++;
                const points = 100 * level;
                score += points;
                element.classList.add('correct');
                element.classList.remove('falling');
                element.classList.add('placed');
                
                // Position at bottom
                element.style.top = (370 - placedReads * 35) + 'px';
                read.placed = true;
                placedReads++;
                
                showMessage(`üéâ Perfect! Correctly placed! +${points} points`, 'success');

                // Level up every 2 correct placements
                if (placedReads % 2 === 0 && level < 5) {
                    level++;
                    fallSpeed = Math.max(300, fallSpeed - 150);
                    showMessage(`üéä Level Up! Level ${level}`, 'success');
                }
            } else {
                element.classList.add('incorrect');
                setTimeout(() => {
                    element.remove();
                }, 500);
                
                showMessage(`‚ùå Position is off! Check the correct position`, 'error');
            }

            placedReadElements.push(element);
            fallingRead = null;

            updateDisplay();
            updateControlButtons();

            // Check completion
            if (placedReads === totalReads) {
                setTimeout(() => {
                    gameCompleted = true;
                    gameRunning = false;
                    updateStatus('gameover');
                    showCompletionModal(true);
                }, 1000);
            } else if (currentReadIndex >= reads.length && !fallingRead) {
                // All reads dropped but not all placed correctly
                setTimeout(() => {
                    gameCompleted = true;
                    gameRunning = false;
                    updateStatus('gameover');
                    showCompletionModal(false);
                }, 1000);
            } else {
                // Spawn next read
                setTimeout(() => {
                    spawnNextRead();
                }, 1500);
            }
        }

        // Toggle pause
        function togglePause() {
            if (!gameRunning || gameCompleted) return;

            gamePaused = !gamePaused;

            if (gamePaused) {
                if (fallInterval) clearInterval(fallInterval);
                updateStatus('paused');
                document.getElementById('pauseBtn').innerHTML = '‚ñ∂Ô∏è Resume';
                showMessage('‚è∏Ô∏è Game Paused', 'info');
            } else {
                updateStatus('playing');
                document.getElementById('pauseBtn').innerHTML = '‚è∏Ô∏è Pause';
                showMessage('Game Resumed!', 'info');
                if (fallingRead) {
                    startFalling();
                }
            }
            updateControlButtons();
        }

        // Update display
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('placed').textContent = `${placedReads}/${totalReads}`;
            document.getElementById('level').textContent = level;
            const accuracy = totalPlacements > 0 ? Math.round((correctPlacements / totalPlacements) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Update status
        function updateStatus(status) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator ${status}`;
            
            switch(status) {
                case 'playing':
                    indicator.textContent = 'Playing';
                    break;
                case 'paused':
                    indicator.textContent = 'Paused';
                    break;
                case 'gameover':
                    indicator.textContent = 'Game Over';
                    break;
            }
        }

        // Show hint
        function showHint() {
            if (!fallingRead) {
                showMessage('üí° Wait for the next read to fall', 'info');
                return;
            }

            const read = fallingRead.read;
            const correctPos = read.correctPosition;
            const targetBases = targetSequence.slice(correctPos, correctPos + 3).join('');
            
            showMessage(`üí° Hint: This read should be at position starting with "${targetBases}..." (position ${correctPos + 1} from left)`, 'info');
        }

        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
        }

        // Show completion modal
        function showCompletionModal(success) {
            const modal = document.getElementById('completionModal');
            
            if (success) {
                document.getElementById('modalTitle').textContent = 'Assembly Complete!';
                document.getElementById('modalMessage').textContent = 'You placed all Short Reads correctly!';
                document.querySelector('.trophy').textContent = 'üèÜ';
            } else {
                document.getElementById('modalTitle').textContent = 'Game Over';
                document.getElementById('modalMessage').textContent = 'Some reads were not placed correctly';
                document.querySelector('.trophy').textContent = 'üòÖ';
            }
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            
            const accuracy = totalPlacements > 0 ? Math.round((correctPlacements / totalPlacements) * 100) : 0;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            
            let rating = 'Good Try!';
            if (success && accuracy === 100) {
                rating = 'Perfect! üåü Flawless Victory!';
            } else if (accuracy >= 80) {
                rating = 'Excellent! ‚≠ê';
            } else if (accuracy >= 60) {
                rating = 'Well Done!';
            }
            document.getElementById('rating').textContent = rating;
            
            modal.classList.add('show');
        }

        // Close modal and start new game
        function closeModalAndStartNew() {
            document.getElementById('completionModal').classList.remove('show');
            startNewGame();
        }

        // Initialize game on load
        window.onload = () => {
            showMessage('Click "New Game" button to start!', 'info');
            updateStatus('paused');
            updateControlButtons();
            document.getElementById('pauseBtn').disabled = true;
        };
    </script>
</body>
</html>

